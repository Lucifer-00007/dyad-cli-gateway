# Dyad CLI Gateway - Setup Scripts

This directory contains automated setup scripts to quickly configure and run the Dyad CLI Gateway project with both frontend and backend components.

## Quick Start

### Linux/macOS
```bash
# Navigate to the setup scripts directory
cd scripts/setup-codebase

# Make script executable and run
chmod +x setup.sh
./setup.sh
```

### Windows
```cmd
# Navigate to the setup scripts directory
cd scripts\setup-codebase

# Run the batch script
setup.bat
```

> **Note**: The scripts will automatically detect your project structure and set up both backend and frontend components. All generated files (logs, startup scripts) will be created in the project root directory for easy access.

## Setup Scripts Overview

### `setup.sh` (Linux/macOS)
Comprehensive bash script with advanced features:
- âœ… System requirements validation
- âœ… Automatic package manager detection (npm/pnpm/yarn/bun)
- âœ… MongoDB connectivity checks
- âœ… Environment file generation with secure defaults
- âœ… Dependency installation with error handling
- âœ… Code quality checks (linting, type checking)
- âœ… Test suite execution
- âœ… Setup verification
- âœ… Startup script generation
- âœ… Comprehensive logging

### `setup.bat` (Windows)
Windows batch script with equivalent functionality:
- âœ… System requirements validation
- âœ… Package manager detection
- âœ… Environment configuration
- âœ… Dependency installation
- âœ… Basic quality checks
- âœ… Startup script generation
- âœ… Windows-specific optimizations

## Important Notes

### Directory Structure
The setup scripts are located in `scripts/setup-codebase/` but operate on the entire project:

```
project-root/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup-codebase/
â”‚       â”œâ”€â”€ setup.sh          # â† Run from here
â”‚       â”œâ”€â”€ setup.bat         # â† Run from here
â”‚       â””â”€â”€ README.md         # â† You are here
â”œâ”€â”€ backend/                  # â† Scripts configure this
â”œâ”€â”€ frontend/                 # â† Scripts configure this
â”œâ”€â”€ setup.log                 # â† Generated in project root
â”œâ”€â”€ start-dev.sh             # â† Generated in project root
â””â”€â”€ start-dev.bat            # â† Generated in project root
```

### Key Points
- **Always run scripts from `scripts/setup-codebase/` directory**
- **Generated files appear in project root for easy access**
- **Scripts automatically detect project structure**
- **Cross-platform compatibility maintained**

## Command Line Options

Both scripts support the following options:

| Option | Description |
|--------|-------------|
| `--skip-deps` | Skip dependency installation (useful for CI/CD) |
| `--skip-db` | Skip MongoDB setup and checks |
| `--skip-tests` | Skip running test suites |
| `--production` | Configure for production environment |
| `--help` | Show detailed help information |

## Usage Examples

### Development Setup (Default)
```bash
# Navigate to setup directory first
cd scripts/setup-codebase

# Full development setup with all checks
./setup.sh

# Skip tests for faster setup
./setup.sh --skip-tests

# Skip database setup (use external MongoDB)
./setup.sh --skip-db
```

### Production Setup
```bash
# Navigate to setup directory first
cd scripts/setup-codebase

# Production configuration
./setup.sh --production

# Production without tests (CI/CD)
./setup.sh --production --skip-tests
```

### CI/CD Pipeline
```bash
# Navigate to setup directory first
cd scripts/setup-codebase

# Minimal setup for automated environments
./setup.sh --skip-deps --skip-db --skip-tests
```

### Windows Examples
```cmd
REM Navigate to setup directory first
cd scripts\setup-codebase

REM Full development setup
setup.bat

REM Production setup
setup.bat --production

REM Skip tests for faster setup
setup.bat --skip-tests
```

## What the Scripts Do

### 1. System Requirements Check
- âœ… Node.js >= 18.0.0
- âœ… npm >= 8.0.0 (or alternative package managers)
- âœ… Git availability
- âœ… Directory structure validation

### 2. Package Manager Detection
Automatically detects and uses the best available package manager:
1. **bun** (if lockfile exists and bun is installed)
2. **pnpm** (if lockfile exists and pnpm is installed)  
3. **yarn** (if lockfile exists and yarn is installed)
4. **npm** (fallback default)

### 3. Database Setup
- Checks for local MongoDB installation
- Tests MongoDB connectivity
- Provides setup instructions for various MongoDB options:
  - Local installation
  - Docker containers
  - MongoDB Atlas (cloud)

### 4. Environment Configuration

#### Backend Environment (`.env`)
```bash
# Generated with secure defaults
PORT=3000
NODE_ENV=development  # or production
MONGODB_URL=mongodb://127.0.0.1:27017/dyad-gateway
JWT_SECRET=<auto-generated-secure-key>
GATEWAY_ENABLED=true
# ... and more
```

#### Frontend Environment (`.env.development` or `.env.production`)
```bash
# API Configuration
VITE_API_BASE_URL=http://localhost:3000
VITE_WS_BASE_URL=ws://localhost:3000

# Environment-specific settings
VITE_ENVIRONMENT=development
VITE_DEBUG_MODE=true  # false in production
VITE_LOG_LEVEL=debug  # error in production

# Feature flags
VITE_FEATURE_FLAGS_ENABLED=true
# ... and more
```

### 5. Dependency Installation
- Uses detected package manager
- Installs with frozen lockfiles for consistency
- Handles installation errors gracefully
- Provides progress feedback

### 6. Code Quality Checks
- **Backend**: ESLint with Airbnb configuration
- **Frontend**: ESLint + TypeScript type checking
- Auto-fixes common issues where possible
- Reports quality issues with actionable feedback

### 7. Test Execution
- **Backend**: Jest test suite with coverage
- **Frontend**: Vitest + React Testing Library
- Runs accessibility tests
- Provides test result summaries

### 8. Setup Verification
- Verifies backend can start successfully
- Confirms frontend can build without errors
- Tests API connectivity
- Validates configuration files

### 9. Startup Scripts Generation

#### Development Scripts
**Linux/macOS** (`start-dev.sh`):
```bash
#!/bin/bash
# Starts both backend and frontend in development mode
# Includes process management and cleanup
```

**Windows** (`start-dev.bat`):
```cmd
@echo off
# Starts backend and frontend in separate windows
# Includes browser auto-launch
```

#### Production Scripts (when `--production` flag is used)
- PM2 process management for backend
- Optimized frontend build and serve
- Production environment configuration

## Generated Files

After successful setup, you'll find these files in the project root:

```
project-root/
â”œâ”€â”€ setup.log              # Detailed setup log
â”œâ”€â”€ start-dev.sh           # Development startup (Linux/macOS)
â”œâ”€â”€ start-dev.bat          # Development startup (Windows)
â”œâ”€â”€ start-prod.sh          # Production startup (Linux/macOS)
â”œâ”€â”€ start-prod.bat         # Production startup (Windows)
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ .env              # Backend environment configuration
â””â”€â”€ frontend/
    â”œâ”€â”€ .env.development  # Development environment
    â””â”€â”€ .env.production   # Production environment (if --production used)
```

## Starting the Application

### After Setup Completion

#### Development Mode
```bash
# From project root directory
./start-dev.sh           # Linux/macOS
start-dev.bat            # Windows

# Manual startup
cd backend && npm run dev    # Terminal 1
cd frontend && npm run dev   # Terminal 2
```

#### Production Mode
```bash
# From project root directory
./start-prod.sh          # Linux/macOS
start-prod.bat           # Windows

# Manual startup
cd backend && npm start
cd frontend && npm run build && npm run preview
```

### Application URLs
- **Admin UI**: http://localhost:8080 (dev) / http://localhost:4173 (prod)
- **Backend API**: http://localhost:3000
- **API Documentation**: http://localhost:3000/docs
- **Health Check**: http://localhost:3000/health

## Troubleshooting

### Common Issues

#### Permission Denied (Linux/macOS)
```bash
chmod +x setup.sh
./setup.sh
```

#### Node.js Version Issues
```bash
# Using nvm (Node Version Manager)
nvm install 18
nvm use 18
./setup.sh
```

#### Package Manager Issues
```bash
# Clear caches and retry
npm cache clean --force
rm -rf node_modules package-lock.json
./setup.sh
```

#### MongoDB Connection Issues
```bash
# Start MongoDB manually
# macOS (Homebrew)
brew services start mongodb-community

# Linux (systemd)
sudo systemctl start mongod

# Docker
docker run -d -p 27017:27017 mongo:5.0

# Skip database setup
./setup.sh --skip-db
```

#### Port Already in Use
```bash
# Find and kill process using port
lsof -i :3000  # or :8080
kill -9 <PID>

# Or modify port in environment files
```

### Log Analysis
```bash
# View detailed setup logs (from project root)
tail -f setup.log

# Search for specific errors
grep -i error setup.log
grep -i warning setup.log
```

### Manual Verification
```bash
# Test backend (from project root)
curl http://localhost:3000/health

# Test frontend build
cd frontend && npm run build

# Check dependencies
cd backend && npm list
cd frontend && npm list
```

## Advanced Configuration

### Custom MongoDB URL
Edit `backend/.env` after setup:
```bash
MONGODB_URL=mongodb://username:password@host:port/database
# or
MONGODB_URL=mongodb+srv://username:password@cluster.mongodb.net/database
```

### Custom API Endpoints
Edit `frontend/.env.development`:
```bash
VITE_API_BASE_URL=https://your-api-domain.com
VITE_WS_BASE_URL=wss://your-api-domain.com
```

### Feature Flags
Enable/disable features in frontend environment:
```bash
VITE_FEATURE_CHAT_PLAYGROUND=true
VITE_FEATURE_BULK_OPERATIONS=false
VITE_FEATURE_ADVANCED_MONITORING=true
```

## CI/CD Integration

### GitHub Actions Example
```yaml
name: Setup and Test
on: [push, pull_request]

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Run setup
        run: |
          cd scripts/setup-codebase
          chmod +x setup.sh
          ./setup.sh --skip-db --skip-tests
      - name: Run tests
        run: |
          cd backend && npm test
          cd frontend && npm run test:run
```

### Docker Integration Example
```dockerfile
# Use setup script in Docker builds
COPY scripts/setup-codebase/setup.sh /app/
WORKDIR /app
RUN chmod +x setup.sh && ./setup.sh --skip-tests --production
```



## Security Considerations

### Generated Secrets
- JWT secrets are automatically generated using cryptographically secure methods
- Secrets are unique per installation
- Production setups use stronger security defaults

### Environment Files
- Never commit `.env` files to version control
- Use different secrets for development and production
- Regularly rotate API keys and secrets

### File Permissions
```bash
# Secure environment files
chmod 600 backend/.env
chmod 600 frontend/.env.*
```

## Support

### Documentation
- [Backend Setup Guide](../../backend/docs/SETUP.md)
- [Frontend Setup Guide](../../frontend/docs/SETUP.md)
- [API Documentation](../../backend/docs/API.md)
- [Troubleshooting Guide](../../frontend/docs/TROUBLESHOOTING.md)

### Getting Help
1. Check the setup log: `tail -f setup.log` (from project root)
2. Review error messages and warnings
3. Consult the troubleshooting section above
4. Check GitHub Issues for known problems
5. Contact support: support@dyad.dev

### Contributing
If you find issues with the setup scripts:
1. Check existing GitHub Issues
2. Create a detailed bug report with:
   - Operating system and version
   - Node.js and npm versions
   - Complete setup.log file
   - Steps to reproduce
3. Submit a Pull Request with fixes

## Script Maintenance

### Updating the Scripts
- Keep Node.js version requirements current
- Update package manager detection logic
- Add new environment variables as needed
- Maintain Windows/Linux compatibility

### Testing the Scripts
```bash
# Test in clean environment
docker run -it --rm -v $(pwd):/app node:18 bash
cd /app/scripts/setup-codebase && ./setup.sh

# Test different scenarios (from scripts/setup-codebase directory)
./setup.sh --skip-deps
./setup.sh --skip-db
./setup.sh --production

# Test Windows script in WSL or Windows environment
setup.bat --skip-tests
```

---

**Happy coding! ðŸš€**

The setup scripts are designed to get you up and running quickly while maintaining flexibility for different environments and use cases.